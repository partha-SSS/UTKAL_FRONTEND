<ng-template #MakerChecker >
  <div class="modal-body text-center" >
    <p>a transaction created by a user cannot be approved by that user.</p>
   <button mat-raised-button type="button" class=" btn btn-primary" (click)="this.modalRef.hide()" >Close</button>
    
  </div>
</ng-template>
<ng-template #Appconfirm >
  <div class="modal-body text-center" >
    <p>Are you sure, you want to <b style="color: rgb(8, 148, 55);">APPROVE</b> this Transaction</p>
    <button mat-raised-button type="button" class="btn btn-light" (click)="this.modalRef.hide()" >No</button>&nbsp;
    <button mat-raised-button type="button" class=" btn btn-primary" (click)="Approve()" >Yes</button>
    
  </div>
</ng-template>
<ng-template #content let-modal>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">Retrieve Voucher</h4>
    <!-- <button type="button" class="close" aria-label="Close" data-dismiss="modal" (click)="modal.dismiss('Cross click')"> -->
      <!-- <span aria-hidden="true">&times;</span> -->
    <!-- </button> -->
  </div> 
  <form [formGroup]="reportcriteria" (ngSubmit)="Submit()">

  <div class="modal-body">
    <div *ngIf="showAlert" class="alert alert-danger alert-dismissible fade show" role="alert" >
      <strong>Error!</strong> {{alertMsg1}}
      <button  type="button" class="close" data-dismiss="alert" aria-label="Close" (click)="closeAlert()">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
      <div>
        <label for="fromDate">From Date</label>
        <div class="input-group">
          <!-- <input id="fromDate" class="form-control" placeholder="yyyy-mm-dd" name="fd" [ngModel]="fromdate  | date:'yyyy-MM-dd' " formControlName="fromDate"
            id="fd" type="date"> -->
            <input type="text" placeholder="dd/mm/yyyy" class="form-control" [ngModel]="fromdate" [readonly]="true" bsDatepicker
            formControlName="fromDate" [bsConfig]="{ dateInputFormat: 'DD/MM/YYYY', containerClass:'theme-dark-blue' }"
            [isOpen]="isOpenFromDp">
          <div class="input-group-append">
            <button mat-raised-button class="btn btn-outline-secondary" type="button" (click)="isOpenFromDp = !isOpenFromDp">
              <i class="fa fa-calendar" aria-hidden="true"></i>
            </button>
          </div>
        </div>
      </div>
      <div>
        <label for="voucherNo">Voucher No</label>
        <div class="input-group">
          <input id="voucherNo" class="form-control" name="vn" formControlName="voucherNo" id="vn" type="text">
        </div>
      </div>
  </div>
  <div class="modal-footer">
    <button mat-raised-button class="btn btn-primary" type="submit">Submit</button> &nbsp;
    <button mat-raised-button class="btn btn-light" type="button" (click)="modalRef.hide()">Close</button>
  </div>
</form>

</ng-template>

<ng-template #contentbatch let-modal bd-example-modal-lg>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">Retrieve All Voucher</h4>
    <!-- <button mat-raised-button type="button" class="close" aria-label="Close" data-dismiss="modal" (click)="modal.dismiss('Cross click')"> -->
      <!-- <span aria-hidden="true">&times;</span> -->
    <!-- </button> -->
  </div>
  <div class="modal-body">
    <!-- Default inline 1-->

    <div class="pb-3">
      <div hidden class="custom-control custom-radio custom-control-inline">
        <input type="radio"  class="custom-control-input" id="U" name="app_flg" [(ngModel)]="app_flg" value="U"
          (change)="changeAppFlg()" mdbInput> 
        <label class="custom-control-label" for="U"><strong class="shiftLabel">UnApproved</strong></label>
      </div>
 <div style="margin-right:10px;"></div>
      <!-- Default inline 2-->
      <!-- <div class="custom-control custom-radio custom-control-inline">
        <input type="radio" class="custom-control-input" id="A" name="app_flg" [(ngModel)]="app_flg" value="A"
          (change)="changeAppFlg()" mdbInput>
        <label class="custom-control-label" for="A"><strong class="shiftLabel">Approved</strong></label>
      </div> -->
    </div>



    <table class="table table-sm table-hover">
      <tr>
        <th>ID</th>
        <th>Date</th>
        <th>Narration</th>
        <th>Type</th>
        <th>Created By</th>
      </tr>
      <tr *ngFor="let item of tvnRetFilter; let i = index;"title="Click to Select"  (click)="OpenVoucher(item)" style="cursor: pointer;">
        <td>{{item.voucher_id}}</td>
        <td>{{item.voucher_dt.substr(0,10)}}</td>
        <td>{{item.narrationdtl}}</td>
        <td>{{item.transaction_type}}</td>
        <td>{{item.created_by}}</td>
      </tr>
    </table>
  </div>
  <div class="modal-footer">
    <!-- <button mat-raised-button class="btn btn-primary" (click)="Submit()">Submit</button> -->
    <button mat-raised-button class="btn btn-light" type="button" (click)="modalRef.hide()">Close</button>
  </div>
</ng-template>
  <loading *ngIf="isLoading"></loading>
  
  <div class="row d-flex justify-content-center align-items-center pt-4"
    style="background-color: #78c2ad21; min-height: 20vh;">
  <ng-template #buttonDiv>
    <div class="col-xs-12 col-sm-12 col-md-8 col-lg-8 shadow-sm mb-4 bg-white p-3">
      <div>
        <button mat-raised-button type="button" class="btn btn-rounded btn-primary btn-primary-spacing btn-sm" [disabled]="isRetrieve"
          (click)="Retrieve()">Retrieve</button>
        <button mat-raised-button type="button" class="btn btn-rounded btn-primary btn-primary-spacing btn-sm" [disabled]="isRetrieveBatch"
          (click)="RetrieveBatch()">Retrieve Batch</button>
        <!-- <button mat-raised-button type="button" class="btn btn-rounded btn-primary btn-primary-spacing btn-sm" [disabled]="isNew"
          (click)="New()">New</button>
        <button mat-raised-button type="button" class="btn btn-rounded btn-primary btn-primary-spacing btn-sm" [disabled]="isRemove"
          (click)="Remove()">Delete</button>
        <button mat-raised-button type="button" class="btn btn-rounded btn-primary btn-primary-spacing btn-sm"
          [disabled]="(!onVoucherCreation.valid || isSave) ? true : false" (click)="Save()">Save</button> -->
        <button mat-raised-button type="button" class="btn btn-rounded btn-primary btn-primary-spacing btn-sm" [disabled]="isApprove"
          (click)="openModal(Appconfirm)">Approve</button>
        <!-- <button mat-raised-button type="button" class="btn btn-rounded btn-primary btn-primary-spacing btn-sm" [disabled]="isClear"
          (click)="Clear()">Clear</button> -->
        <button mat-raised-button type="button" class="btn btn-rounded btn-primary btn-primary-spacing btn-sm" (click)="closeScreen()"
          style="position: absolute;right: 10px;">Close</button>
        <!-- <input type="text" value="{{ getTotalCr() }}" />
    <input type="text" value="{{ getTotalCr() }}" /> -->
      </div>
    </div>
  </ng-template>
   <ng-container *ngTemplateOutlet="buttonDiv">

   </ng-container>
    <div class="col-xs-12 col-sm-12 col-md-10 col-lg-10 shadow-sm mb-4 bg-white p-3">
      <div *ngIf="showMsg && showMsg.Show" class="col-xs-12 col-sm-12 col-md-11 col-lg-11 shadow mb-2 bg-white p-3">
        <div class="alert alert-dismissible fade show" role="alert" [ngClass]="{'alert-success': showMsg.Type === 0,
         'alert-warning':showMsg.Type === 1, 'alert-info':showMsg.Type === 2, 'alert-danger':showMsg.Type === 3 }">
          <strong>{{showMsg.Message}}</strong>
          <button type="button" class="close" data-dismiss="alert" (click)="showMsg = null" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
      </div>
      <div class="form-group">
        <div class="form-group col-xs-12">
          <table class="table table-bordered table-striped">
            <thead>
              <tr>
                <td>
                  <h4>Voucher ID :</h4>
                  <h3> {{_voucherId}} </h3>
                </td>
                <td>
                  <h4>Voucher Dt : </h4>
                  <h3>{{_voucherDt}}</h3>
                </td>
                <td *ngIf="!insertMode">
                  <h4>Voucher Type : </h4>
                  <h3>{{_voucherTyp}}</h3>
                </td>
                <td *ngIf="insertMode">
                  <h4>Voucher Type : </h4>
                  <h3>
                    <select name="voucherTyp" class="rounded-inputs20 select-select col-md-6"
                      (change)="onChange($event.target.value)">
                      <option >Select..</option>
                      <option value="C">Cash</option>
                      <option value="L">Clearing</option>
                      <option value="T">Transfer</option>
                    </select>
                  </h3>
                </td>
                <td>
                  <h4>Approval Status : </h4>
                  <h3>{{_approvalSts}}</h3>
                </td>
              </tr>
            </thead>
          </table>
          <table class="table table-bordered table-striped">
            <tbody>
              <tr>
                <td style="width: 12%"><b>Debit/Credit</b></td>
                <td style="width: 11%"><b>Account Code</b></td>
                <td style="width: 47%"><b>Description</b></td>
                <td style="width: 11%"><b>Debit Amount</b></td>
                <td style="width: 11%"><b>Credit Amount</b></td>
                <td style="width: 8%"><b></b></td>
              </tr>
            </tbody>
          </table>
  
          <div [formGroup]="onVoucherCreation">
            <table class="table table-bordered table-striped --head-bg-metal">
              <!-- <div formArrayName="VoucherF" *ngFor="let item of onVoucherCreation.get('VoucherF').controls; let i = index;"> -->
              <tbody>
                <tr formArrayName="VoucherF" *ngFor="let item of voucherData.controls; let i = index;">
                  <div [formGroupName]="i">
                    <td style="width: 12%"><input formControlName="dr_cr" type="text" [readonly]="true" class="form-control fonm-control-sm"></td>
                    <td style="width: 11%"><input formControlName="acc_cd" type="text" [readonly]="true" class="form-control form-control-sm"></td>
                    <td style="width: 47%">
                      <!-- <div class="ng-autocomplete"> -->
                      <ng-autocomplete [data]="maccmaster" [searchKeyword]="keyword"  placeHolder="Account Name"
                        (selected)='selectEvent($event,i)' (inputChanged)='onChangeSearch($event,i)'
                        (inputFocused)='onFocused($event)' historyIdentifier="maccmaster" [itemTemplate]="itemTemplate"
                        [disabled]="true"
                        [notFoundTemplate]="notFoundTemplate" formControlName="desc">
                      </ng-autocomplete>
                      <ng-template #itemTemplate let-item>
                        <table>
                          <tbody>
                            <tr>
                              <td style="width: 10%"><a [innerHTML]="item.acc_type"></a> </td>
                              <td style="width: 20%"><a [innerHTML]="item.acc_cd"></a> </td>
                              <td style="width: 70%"><a [innerHTML]="item.acc_name"></a> </td>
                            </tr>
                          </tbody>
                        </table>
                      </ng-template>
  
                      <ng-template #notFoundTemplate let-notFound>
                        <div [innerHTML]="notFound"></div>
                      </ng-template>
                      <!-- </div> -->
                    </td>
                    <!-- <td style="width: 40%"><input formControlName="desc"  type="text" class="form-control"></td> -->
                    <td style="width: 11%"><input formControlName="dr_amt" [readonly]="true" (input)="drAmountInput(i,$event)" type="number"
                        class="form-control form-control-sm"></td>
                    <td style="width: 11%"><input formControlName="cr_amt" [readonly]="true" (input)="crAmountInput(i,$event)" type="number"
                        class="form-control form-control-sm"></td>
                        <td style="width: 8%"></td>
                    <!-- <td style="width: 10%"><button mat-raised-button class="btn btn-rounded btn-primary btn-primary-spacing btn-sm"
                        (click)="RemoveItem(i)" [disabled]="isDel">Del</button> 
                      <button mat-raised-button  class="btn btn-rounded btn-primary btn-primary-spacing" >Edit</button>  
                    </td>-->
                  </div>
                </tr>
              </tbody>
              <!-- </div> -->
            </table>
          </div>
          <table class="table table-bordered table-striped">
            <tbody>
              <tr>
                <!-- <td style="width: 10%"><b></b></td>
                  <td style="width: 10%"><b></b></td> -->
                <td style="width: 60%"><b>Grand Total</b></td>
                <td style="width: 10%"><b>{{ getTotalDr()}}</b></td>
                <td style="width: 10%"><b>{{ getTotalCr()}}</b></td>
                <!-- <td style="width: 10%"><b><button mat-raised-button class="btn btn-rounded btn-primary btn-primary-spacing btn-sm"
                      (click)="AddNew()" [disabled]="isAddNew">Add</button></b></td> -->
              </tr>
            </tbody>
          </table>
          <div>
            <label><strong>Narration</strong></label>
            <input readonly name="narr" value="{{_voucherNarration}}" [(ngModel)]="_voucherNarration" type="text"
              class="form-control form-control-sm">
          </div>
  
        </div>
      </div>
    </div>
    <ng-container *ngTemplateOutlet="buttonDiv">

    </ng-container>
  </div>
  
  
  